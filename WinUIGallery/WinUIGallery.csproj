<Project Sdk="Microsoft.NET.Sdk">
    <Sdk Name="Microsoft.Build.CentralPackageVersions" Version="2.0.1" />
    <PropertyGroup>
        <OutputType>WinExe</OutputType>
        <TargetFramework>$(SamplesTargetFrameworkMoniker)</TargetFramework>
        <TargetPlatformVersion>$(WindowsSdkTargetPlatformVersion)</TargetPlatformVersion>
        <TargetPlatformMinVersion>$(WindowsAppSdkTargetPlatformVersion)</TargetPlatformMinVersion>
        <UseWinUI>true</UseWinUI>
        <ApplicationManifest>app.manifest</ApplicationManifest>
        <Platforms>x86;x64;ARM64</Platforms>
        <NoWarn>8305</NoWarn>
        <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
        <RuntimeIdentifiers>win-x86;win-x64;win-arm64</RuntimeIdentifiers>
        <NoWarn>
            0108;   <!-- 'x' hides inherited member 'y'. Use the new keyword if hiding was intended. -->
            8305    <!-- 'x' is for evaluation purposes only and is subject to change or removal in future updates. -->
        </NoWarn>
        <MSBuildWarningsAsMessages>
            WMC1501 <!-- x is for evaluation purposes only and is subject to change or removal in future updates. -->
        </MSBuildWarningsAsMessages>
        <ErrorOnDuplicatePublishOutputFiles>false</ErrorOnDuplicatePublishOutputFiles>
        <Configurations>Debug;Release;Debug-Unpackaged;Release-Unpackaged</Configurations>
        <Release>true</Release>
        <Release Condition="'$(Configuration)' == 'Debug' Or '$(Configuration)' == 'Debug-Unpackaged'">false</Release>
        <Packaged>true</Packaged>
        <Packaged Condition="'$(Configuration)' == 'Debug-Unpackaged' Or '$(Configuration)' == 'Release-Unpackaged'">false</Packaged>
        <Optimized>true</Optimized>
        <Optimized Condition="'$(Configuration)' == 'Debug-Unpackaged' Or '$(Configuration)' == 'Debug'">false</Optimized>
        <!-- In .NET 8, serialization is prohibited by default - we can safely use it since we're not dealing with UDTs. -->
        <!-- <JsonSerializerIsReflectionEnabledByDefault>true</JsonSerializerIsReflectionEnabledByDefault> -->
        <SingleProject>true</SingleProject>
        <SingleProject Condition="'$(SolutionName)' == 'WinUIGallery.DesktopWap'">false</SingleProject>
        <WindowsAppSdkIncludeVersionInfo>true</WindowsAppSdkIncludeVersionInfo>
        <PublishProfile>win-$(Platform).pubxml</PublishProfile>
        <!-- Note: PublishAot does not support x86. -->
        <PublishAot Condition="'$(PublishAot)' == '' and '$(Optimized)' == 'true' and ('$(Platform)' == 'x64' or '$(Platform)' == 'arm64')">true</PublishAot>
        <IsAotCompatible>true</IsAotCompatible>
        <IsTrimmable>true</IsTrimmable>    
        <!-- Note: PublishAot and PublishSingleFile cannot be specified at the same time. -->
        <PublishSingleFile Condition="'$(PublishSingleFile)' == '' and '$(Packaged)' != 'true' and '$(PublishAot)' != 'true'">true</PublishSingleFile>
        <WindowsAppSdkSelfContained Condition="'$(WindowsAppSdkSelfContained)' == '' and '$(PublishSingleFile)' == 'true'">true</WindowsAppSdkSelfContained>
        <!-- Enable ExplicitlyIncludeVersionInfo workaround by setting WindowsAppSdkSelfContained earlier than the mock package would -->
        <WindowsAppSdkSelfContained Condition="'$(IsInWinUIRepo)' == 'true' and '$(WindowsAppSdkSelfContained)'==''">true</WindowsAppSdkSelfContained>
        <IlcGenerateMstatFile>true</IlcGenerateMstatFile>
        <IlcGenerateDgmlFile>true</IlcGenerateDgmlFile>
    </PropertyGroup>

    <PropertyGroup Condition="'$(Packaged)' != 'true' and '$(SingleProject)'=='true'">
        <EnableMsixTooling>false</EnableMsixTooling>
        <EnableMsixTooling Condition="'$(PublishSingleFile)'=='true'">true</EnableMsixTooling>
        <WindowsPackageType>None</WindowsPackageType>
    </PropertyGroup>

    <PropertyGroup Condition="'$(Packaged)' == 'true' and '$(SingleProject)'=='true'">
        <WindowsPackageType>MSIX</WindowsPackageType>
        <AppxBundleNameForOutput>WinUIGallery</AppxBundleNameForOutput>
        <EnableMsixTooling>true</EnableMsixTooling>
        <SDKIdentifier>Windows</SDKIdentifier>
        <DefaultLanguage>en-US</DefaultLanguage>
        <AppxPackage>true</AppxPackage>
        <AppxPackageSigningEnabled>True</AppxPackageSigningEnabled>
        <GenerateAppInstallerFile>False</GenerateAppInstallerFile>
        <AssetTargetFallback>net5.0-windows$(TargetPlatformVersion);net6.0-windows$(TargetPlatformVersion);$(AssetTargetFallback)</AssetTargetFallback>
        <AppxPackageSigningTimestampDigestAlgorithm>SHA256</AppxPackageSigningTimestampDigestAlgorithm>
        <AppxAutoIncrementPackageRevision>False</AppxAutoIncrementPackageRevision>
        <GenerateTestArtifacts>True</GenerateTestArtifacts>
        <AppxBundlePlatforms>$(Platform)</AppxBundlePlatforms>
        <AppxBundlePlatforms Condition="'$(BuildAllAppFlavors)' == 'true'">x86|x64|ARM64</AppxBundlePlatforms>
        <AppxBundle>Always</AppxBundle>
        <HoursBetweenUpdateChecks>0</HoursBetweenUpdateChecks>
        <SDKVersion>10.0</SDKVersion>
        <PfxFile>$(MSBuildProjectDirectory)\..\build\WinUI-Gallery-Test.pfx</PfxFile>
        <PackageCertificateKeyFile Condition="Exists('$(PfxFile)')">$(PfxFile)</PackageCertificateKeyFile>
    </PropertyGroup>

    <ItemGroup Condition="'$(Packaged)' == 'true' and '$(SingleProject)'=='true'">
        <AppxManifest Include="Package.appxmanifest" Condition="'$(Release)' == 'true'">
            <SubType>Designer</SubType>
        </AppxManifest>
        <AppxManifest Include="Package.Dev.appxmanifest" Condition="'$(Release)' == 'false'">
            <SubType>Designer</SubType>
        </AppxManifest>
    </ItemGroup>

    <PropertyGroup Condition="'$(IsInWinUIRepo)' == 'true'">
        <GenerateAppInstallerFile>true</GenerateAppInstallerFile>
        <!-- URI must be absolute so this is really only useful for testing a locally produced AppInstaller. -->
        <AppInstallerUri>$(AppxPackageDir)</AppInstallerUri>
        <!-- False until https://task.ms/31482969 is implemented -->
        <AppxBundle>Never</AppxBundle>
    </PropertyGroup>

    <Import Project="Common.props" />

    <ItemGroup>
      <Compile Remove="Assets\ControlIcons\**" />
      <Content Remove="Assets\ControlIcons\**" />
      <EmbeddedResource Remove="Assets\ControlIcons\**" />
      <None Remove="Assets\ControlIcons\**" />
      <Page Remove="Assets\ControlIcons\**" />
      <PRIResource Remove="Assets\ControlIcons\**" />
    </ItemGroup>

    <!-- In the WinUI repo, package reference versions are controlled centrally by a Packages.props.  We will
            just add versionless PackageReferences here.  They will be updated to their actual versions by either the Packages.props file
            in the WinUI repo, or the next ItemGroup below when standalone. -->
    <ItemGroup>
        <PackageReference Include="Microsoft.WindowsAppSDK" />
        <PackageReference Include="ColorCode.Core" />
        <PackageReference Include="Microsoft.Graphics.Win2D" />
        <PackageReference Include="Microsoft.Windows.CsWinRT" />
        <PackageReference Include="CommunityToolkit.WinUI.Controls.Segmented" />
        <PackageReference Include="CommunityToolkit.WinUI.Controls.SettingsControls" />
        <PackageReference Include="CommunityToolkit.WinUI.Converters" />
        <PackageReference Include="CommunityToolkit.WinUI.Animations" />
        <Manifest Include="$(ApplicationManifest)" />
        <!-- System.Private.Uri is pulled in transitively through ColorCode.Core and contains vulnerabilities
          CVE-2019-0657, CVE-2019-0980, and CVE-2019-0981. Since no meta-package depends on version 4.3.2, which
          addresses those vulnerabilites, we need to pull it in ourselves. -->
        <PackageReference Include="System.Private.Uri" />
    </ItemGroup>

    <ItemGroup Condition="'$(IsInWinUIRepo)' != 'true'">
        <PackageReference Update="Microsoft.WindowsAppSDK" Version="$(WindowsAppSdkPackageVersion)" />
        <PackageReference Remove="ColorCode.Core" />
        <PackageReference Include="ColorCode.WinUI" Version="$(ColorCodeVersion)" />
        <PackageReference Update="CommunityToolkit.WinUI.Controls.Segmented" Version="$(CommunityToolkitWinUIVersion)" />
        <PackageReference Update="CommunityToolkit.WinUI.Controls.SettingsControls" Version="$(CommunityToolkitWinUIVersion)" />
        <PackageReference Update="CommunityToolkit.WinUI.Converters" Version="$(CommunityToolkitWinUIVersion)" />
        <PackageReference Update="CommunityToolkit.WinUI.Animations" Version="$(CommunityToolkitWinUIVersion)" />
        <PackageReference Update="Microsoft.Graphics.Win2D" Version="$(GraphicsWin2DVersion)" />
        <!-- Get latest WinRT.Runtime.dll from C#/WinRT -->
        <PackageReference Update="Microsoft.Windows.CsWinRT" Version="$(MicrosoftCsWinRTPackageVersion)" />
        <PackageReference Update="System.Private.Uri" Version="4.3.2" />
      </ItemGroup>

    <ItemGroup>
        <Compile Remove="CollectionsInterop.cs" />
        <Compile Remove="Behaviors\ImageScrollBehavior.cs" />
        <Compile Remove="ControlPages\ScrollViewer2Page.xaml.cs" />
        <Compile Remove="ControlPages\InputValidationPage.xaml.cs" />
        <Page Remove="ControlPages\ScrollViewer2Page.xaml" />
        <Page Remove="ControlPages\InputValidationPage.xaml" />
        <!-- RichTextBlockFormatter is defined in ColorCode.WinUI outside the WinUI repo -->
        <Compile Remove="Helper\ColorCode.internal\RichTextBlockFormatter.cs" Condition="'$(IsInWinUIRepo)' != 'true'" />
        <Compile Remove="Helper\ColorCode.internal\ExtensionMethods.cs" Condition="'$(IsInWinUIRepo)' != 'true'" />
        <Content Remove="@(Content)" />
    </ItemGroup>

    <ItemGroup>
        <None Remove="Assets\Tiles\GalleryIcon.ico" />
        <None Remove="ControlPagesSampleCode\Icons\FontIconSample2_xaml.txt" />
        <None Remove="ControlPagesSampleCode\Typography\TypographySample_xaml.txt" />
        <None Remove="ControlPages\DesignGuidance\ColorsPage.xaml" />
        <None Remove="ControlPages\InfoBadgePage.xaml" />
        <None Remove="ControlPages\LinePage.xaml" />
        <None Remove="ControlPages\SelectorBarPage.xaml" />
        <None Remove="ControlPages\ShapePage.xaml" />
        <None Remove="ControlPages\Typography.xaml" />
        <None Remove="Controls\CopyButton\CopyButton.xaml" />
        <None Remove="Controls\DesignGuidance\ColorPageExample.xaml" />
        <None Remove="Controls\DesignGuidance\ColorSections\HighContrastSection.xaml" />
        <None Remove="Controls\DesignGuidance\ColorSections\SignalSection.xaml" />
        <None Remove="Controls\DesignGuidance\ColorSections\TextSection.xaml" />
        <None Remove="Controls\DesignGuidance\ColorTile.xaml" />
        <None Remove="Controls\DesignGuidance\TypographyControl.xaml" />
        <None Remove="Controls\HomePageHeaderImage.xaml" />
        <None Remove="Controls\PageHeader.xaml" />
        <None Remove="Controls\SampleThemeListener.xaml" />
        <None Remove="DataModel\IconsData.json" />
        <None Remove="SamplePages\SampleBuiltInSystemBackdropsWindow.xaml" />
    </ItemGroup>

    <ItemGroup>
        <Content Include="Assets\GalleryHeaderImage.png" />
        <Content Include="Assets\HomeHeaderTiles\Header-Store.dark.png" />
        <Content Include="Assets\HomeHeaderTiles\Header-Store.light.png" />
        <Content Include="Assets\HomeHeaderTiles\Header-Toolkit.png" />
        <Content Include="Assets\HomeHeaderTiles\Header-WindowsDesign.png" />
        <Content Include="Assets\HomeHeaderTiles\Header-WinUIGallery.png" />
        <Content Include="Assets\Tiles\GalleryIcon.ico" />
        <Content Include="Assets\Tiles\SmallTile-sdk.altform-lightunplated_targetsize-16.png" />
        <Content Include="Assets\Tiles\SmallTile-sdk.altform-lightunplated_targetsize-24.png" />
        <Content Include="Assets\Tiles\SmallTile-sdk.altform-lightunplated_targetsize-256.png" />
        <Content Include="Assets\Tiles\SmallTile-sdk.altform-lightunplated_targetsize-32.png" />
        <Content Include="Assets\Tiles\SmallTile-sdk.altform-lightunplated_targetsize-48.png" />
        <Content Include="Assets\Tiles\TitlebarLogo.png" />
        <Content Include="Assets\Typography.dark.png" />
        <Content Include="Assets\Typography.light.png" />
        <Content Include="ControlPagesSampleCode\Icons\FontIconSample2_xaml.txt" />
        <Content Include="DataModel\IconsData.json" />
        <Content Include="DataModel\ControlInfoData.json" />
    </ItemGroup>
    <ItemGroup>
        <Content Include="ControlPagesSampleCode\Typography\TypographySample_xaml.txt" />
    </ItemGroup>
    <ItemGroup>
        <Page Update="Controls\CopyButton\CopyButton.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="ControlPages\InfoBadgePage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\DesignGuidance\ColorSections\HighContrastSection.xaml">
          <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="Controls\SampleThemeListener.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="Controls\HomePageHeaderImage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="Controls\PageHeader.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="Controls\DesignGuidance\ColorSections\SignalSection.xaml">
            <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
        </Page>
        <Page Update="Controls\DesignGuidance\ColorTile.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="Controls\DesignGuidance\ColorPageExample.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="ControlPages\Typography.xaml">
            <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
        </Page>
        <Page Update="ControlPages\Typography.xaml">
            <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
        </Page>
        <Page Update="ControlPages\Typography.xaml">
            <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
        </Page>
        <Page Update="ControlPages\Typography.xaml">
            <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
        </Page>
        <Page Update="ControlPages\LinePage.xaml">
            <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
            <SubType>Designer</SubType>
        </Page>
        <Page Update="ControlPages\ShapePage.xaml">
            <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="Controls\DesignGuidance\TypographyControl.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="ControlPages\DesignGuidance\ColorsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
    <ItemGroup>
        <Page Update="Controls\DesignGuidance\ColorSections\TextSection.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="ControlPages\SelectorBarPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="SamplePages\SampleBuiltInSystemBackdropsWindow.xaml">
            <XamlRuntime>$(DefaultXamlRuntime)</XamlRuntime>
        </Page>
    </ItemGroup>
    <ItemGroup>
      <Folder Include="ControlPages\Accessibility\" />
    </ItemGroup>
    <Import Project="ContentIncludes.props" />
    <!--Per comment in Microsoft.Common.CurrentVersion.targets, the default GetCopyToPublishDirectoryItems 
        just returns GetCopyToOutputDirectoryItems, which automatically includes the ContentWithTargetPath
        and _NoneWithTargetPath items in the MSIX package.  The .NET GetCopyToPublishDirectoryItems 
        overrides this and drops all these items unless they're specifically set to copy to the output
        directory.  The default behavior is easier, so we'll mimic that here.-->
    <Target Name="AddCopyToPublishDirectoryItems" Condition="'$(PublishSingleFile)'=='true'" BeforeTargets="GetCopyToPublishDirectoryItems" DependsOnTargets="AssignTargetPaths">
        <ItemGroup>
            <CurrentContentWithTargetPath Include="@(ContentWithTargetPath)" />
            <ContentWithTargetPath Remove="@(CurrentContentWithTargetPath )" />
            <ContentWithTargetPath Include="@(CurrentContentWithTargetPath )">
                <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
            </ContentWithTargetPath>
            <CurrentNoneWithTargetPath Include="@(_NoneWithTargetPath)" />
            <_NoneWithTargetPath Remove="@(CurrentNoneWithTargetPath )" />
            <_NoneWithTargetPath Include="@(CurrentNoneWithTargetPath )">
                <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
            </_NoneWithTargetPath>
        </ItemGroup>
    </Target> 
</Project>