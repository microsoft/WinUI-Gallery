<local:ItemsPageBase
    x:Class="AppUIBasics.ControlPages.ItemsRepeaterPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AppUIBasics"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:l="using:AppUIBasics.ControlPages"
    xmlns:common="using:AppUIBasics.Common"
    mc:Ignorable="d" FontFamily="Segoe UI">

    <Page.Resources>
        <DataTemplate x:Key="HorizontalBarTemplate" x:DataType="l:Bar">
            <Border Background="{ThemeResource SystemChromeLowColor}" Width="{x:Bind MaxLength}">
                <Rectangle Fill="{ThemeResource SystemAccentColor}" Width="{x:Bind Length}" Height="24" HorizontalAlignment="Left"/>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="VerticalBarTemplate" x:DataType="l:Bar">
            <Border Background="{ThemeResource SystemChromeLowColor}" Height="{x:Bind MaxHeight}">
                <Rectangle Fill="{ThemeResource SystemAccentColor}" Height="{x:Bind Height}" Width="48" VerticalAlignment="Top"/>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="CircularTemplate" x:DataType="l:Bar">
            <Grid>
                <Ellipse Fill="{ThemeResource SystemChromeLowColor}" Height="{x:Bind MaxDiameter}" Width="{x:Bind MaxDiameter}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                <Ellipse Fill="{ThemeResource SystemAccentColor}" Height="{x:Bind Diameter}" Width="{x:Bind Diameter}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="NormalItemTemplate" x:DataType="x:Int32">
            <Button HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="{ThemeResource SystemChromeLowColor}">
                <TextBlock Text="{x:Bind}"/>
            </Button>
        </DataTemplate>

        <DataTemplate x:Key="AccentItemTemplate" x:DataType="x:Int32">
            <Button HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="{ThemeResource SystemAccentColor}">
                <TextBlock Text="{x:Bind}"/>
            </Button>
        </DataTemplate>

        <DataTemplate x:Key="StringDataTemplate" x:DataType="x:String">
            <Grid Background="{ThemeResource SystemControlBackgroundAccentBrush}" Margin="10">
                <TextBlock Padding="10" Text="{x:Bind}" Foreground="{ThemeResource SystemControlForegroundChromeWhiteBrush}" HorizontalAlignment="Center" TextWrapping="Wrap" VerticalAlignment="Center"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="StringDataTemplateColor" x:DataType="x:String">
            <Grid Background="{ThemeResource SystemControlBackgroundAccentBrush}" Margin="10, 0, 10, 10">
                <TextBlock Padding="8" Text="{x:Bind}" Foreground="{ThemeResource SystemControlForegroundChromeWhiteBrush}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="IntDataTemplate" x:DataType="x:Int32">
            <Grid Background="{ThemeResource SystemChromeLowColor}" Margin="10">
                <TextBlock Padding="10" Text="{x:Bind}" Style="{StaticResource HeaderTextBlockStyle}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="ImageTemplate" x:DataType="x:String">
            <StackPanel>
                <Image Height="200" Source="{x:Bind}" Margin="5"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="CategoryTemplate" x:DataType="l:NestedCategory">
            <StackPanel>
                <TextBlock Text="{x:Bind CategoryName}" Padding="8" Style="{StaticResource TitleTextBlockStyle}"/>
                <muxc:ItemsRepeater x:Name="innerRepeater"
                                    ItemsSource="{x:Bind CategoryItems}"
                                    ItemTemplate="{StaticResource StringDataTemplateColor}">
                    <muxc:ItemsRepeater.Layout>
                        <muxc:StackLayout Orientation="Horizontal" />
                    </muxc:ItemsRepeater.Layout>
                </muxc:ItemsRepeater>
            </StackPanel>
        </DataTemplate>

        <muxc:StackLayout x:Name="VerticalStackLayout" Orientation="Vertical" Spacing="8"/>
        <muxc:StackLayout x:Name="HorizontalStackLayout" Orientation="Horizontal" Spacing="8"/>
        <muxc:UniformGridLayout x:Name="UniformGridLayout" MinRowSpacing="8" MinColumnSpacing="8"/>

        <common:ActivityFeedLayout x:Key="MyFeedLayout" ColumnSpacing="12" RowSpacing="12" MinItemSize="80, 108"/>
        <muxc:UniformGridLayout x:Key="UniformGridLayout2" MinItemWidth="108" MinItemHeight="108" MinRowSpacing="12" MinColumnSpacing="12"/>

        <l:MyDataTemplateSelector x:Key="MyDataTemplateSelector"
                                  Normal="{StaticResource NormalItemTemplate}"
                                  Accent="{StaticResource AccentItemTemplate}"/>

        <l:StringOrIntTemplateSelector x:Key="StringOrIntTemplateSelector"
                                       StringTemplate="{StaticResource StringDataTemplate}"
                                       IntTemplate="{StaticResource IntDataTemplate}"/>
    </Page.Resources>

    <StackPanel>
        <local:ControlExample HeaderText="Basic, non-interactive items laid out by ItemsRepeater">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                          HorizontalScrollMode="Auto" 
                          IsVerticalScrollChainingEnabled="False"
                          MaxHeight="500">
                <muxc:ItemsRepeater x:Name="repeater"
                               Layout="{StaticResource VerticalStackLayout}"
                               ItemsSource="{x:Bind BarItems}"
                               ItemTemplate="{StaticResource HorizontalBarTemplate}"/>
            </ScrollViewer>
            <local:ControlExample.Options>
                <StackPanel Spacing="12">
                    <Button x:Name="AddBtn" Content="Add Item" Click="AddBtn_Click" MinWidth="150"/>
                    <Button x:Name="DeleteBtn" Content="Remove Item" Click="DeleteBtn_Click" MinWidth="150"/>

                    <RadioButton x:Name="VStackBtn" 
                                 GroupName="Sample1Layouts"
                                 Margin="0,24,0,0"
                                 Content="StackLayout - Vertical"
                                 Click="RadioBtn_Click"
                                 Tag="VerticalStackLayout"
                                 IsChecked="True"/>
                    <RadioButton x:Name="HStackBtn"
                                 GroupName="Sample1Layouts"
                                 Content="StackLayout - Horizontal"
                                 Tag="HorizontalStackLayout"
                                 Click="RadioBtn_Click"/>
                    <RadioButton x:Name="HGridBtn"
                                 GroupName="Sample1Layouts"
                                 Content="UniformGridLayout"
                                 Tag="UniformGridLayout"
                                 Click="RadioBtn_Click"/>
                </StackPanel>
            </local:ControlExample.Options>

            <local:ControlExample.Xaml>
                <x:String xml:space="preserve">

&lt;!-- The ItemsRepeater and ScrollViewer used: --&gt;
&lt;ScrollViewer HorizontalScrollBarVisibility="Auto" 
        HorizontalScrollMode="Auto" 
        IsVerticalScrollChainingEnabled="False"
        MaxHeight="500"&gt;
    &lt;ItemsRepeater
        ItemsSource="{x:Bind BarItems}"
        Layout="{StaticResource $(Layout)}"
        ItemTemplate="{StaticResource $(ElementGenerator)}" /&gt;
&lt;ScrollViewer/&gt;
                    
&lt;!-- The Layout specifications used: --&gt;
                    
$(displayLayout)     
                    
&lt;!-- The DataTemplate used: $(ElementGenerator)--&gt;
                    
$(displayDataTemplate)                    
                    
&lt;!-- The ItemsSource used is a list of custom-class Bar objects called BarItems. Bar objects have 
the following attributes: Height, MaxHeight, Length, MaxLength, Diameter, and MaxDiameter. --&gt;
    </x:String>
            </local:ControlExample.Xaml>
            <local:ControlExample.Substitutions>
                <local:ControlExampleSubstitution x:Name="layout" Key="Layout" Value="VerticalStackLayout" />
                <local:ControlExampleSubstitution x:Name="elementGenerator" Key="ElementGenerator" Value="HorizontalBarTemplate" />
                <local:ControlExampleSubstitution x:Name="displayLayout" Key="displayLayout"/>
                <local:ControlExampleSubstitution x:Name="displayDataTemplate" Key="displayDataTemplate"/>
            </local:ControlExample.Substitutions>
        </local:ControlExample>

        <local:ControlExample HeaderText="Virtualizing, scrollable list of items laid out by ItemsRepeater"
                              HorizontalContentAlignment="Stretch"
                              XamlSource="ItemsRepeater/ItemsRepeaterSample2_xaml.txt"
                              CSharpSource="ItemsRepeater/ItemsRepeaterSample2_cs.txt">

            <!-- ItemsRepeaterScrollHost enables ItemsRepeater to coordinate with ScrollViewer down-level.
                 It's not needed on 17700+ builds. -->
            <muxc:ItemsRepeaterScrollHost>
                <ScrollViewer x:Name="scrollViewer"
                              Height="400"
                              IsVerticalScrollChainingEnabled="False"
                              Padding="0,0,16,0">

                    <muxc:ItemsRepeater x:Name="repeater2" 
                                       Margin="0,0,12,0"
                                       HorizontalAlignment="Stretch"
                                       Layout="{StaticResource MyFeedLayout}"
                                       ItemTemplate="{StaticResource MyDataTemplateSelector}"/>

                </ScrollViewer>
            </muxc:ItemsRepeaterScrollHost>

            <local:ControlExample.Options>
                <StackPanel Spacing="12">
                    <RadioButton GroupName="Sample2Layouts" Content="Uniform grid" Tag="UniformGridLayout2" Click="LayoutBtn_Click"/>
                    <RadioButton GroupName="Sample2Layouts" IsChecked="True" Content="Custom virtualizing layout" Tag="MyFeedLayout" Click="LayoutBtn_Click"/>
                </StackPanel>
            </local:ControlExample.Options>

            <local:ControlExample.Substitutions>
                <local:ControlExampleSubstitution x:Name="layout2" Key="Layout" Value="MyFeedLayout" />
                <local:ControlExampleSubstitution Key="ItemTemplate" Value="SimpleItemTemplate" />
                <local:ControlExampleSubstitution x:Name="displayLayout2" Key="displayLayout2"/>
            </local:ControlExample.Substitutions>
        </local:ControlExample>
        
        <local:ControlExample HeaderText="ItemsRepeater with mixed-type collection"
                              XamlSource="ItemsRepeater/ItemsRepeaterSample1_xaml.txt"
                              CSharpSource="ItemsRepeater/ItemsRepeaterSample1_cs.txt">
            <StackPanel>
                <TextBlock Text="This is an ItemsRepeater that displays both integer and string items. It uses a DataTemplateSelector to choose the correct layout for each of its items. The full source code for this ItemsRepeater is below." TextWrapping="Wrap"/>
                <muxc:ItemsRepeater x:Name="MixedTypeRepeater" 
                                           Margin="0,0,12,0"
                                           HorizontalAlignment="Stretch"
                                           ItemTemplate="{StaticResource StringOrIntTemplateSelector}">        

                    <muxc:ItemsRepeater.Layout>
                        <muxc:UniformGridLayout MinItemWidth="200" MinItemHeight="200"></muxc:UniformGridLayout>
                    </muxc:ItemsRepeater.Layout>
                </muxc:ItemsRepeater>
            </StackPanel>
        </local:ControlExample>

        <local:ControlExample HeaderText="Laying out nested ItemsRepeaters">
            <ScrollViewer>
                <muxc:ItemsRepeater x:Name="outerRepeater"
                                           VerticalAlignment="Top"
                                           ItemTemplate ="{StaticResource CategoryTemplate}">

                    <muxc:ItemsRepeater.Layout>
                        <muxc:StackLayout Orientation="Vertical" />
                    </muxc:ItemsRepeater.Layout>

                </muxc:ItemsRepeater>
            </ScrollViewer>

            <local:ControlExample.Xaml>
                <x:String xml:space="preserve">
&lt;!-- The nested ItemsRepeater experience is achieved by creating one ItemsRepeater (outerRepeater below) 
and creating another ItemsRepeater (innerRepeater below) inside the outer one's DataTemplate. Below is 
the outer ItemsRepeater definition and the DataTemplate it uses. --&gt;
                    
&lt;ScrollViewer&gt;
    &lt;ItemsRepeater 
        x:Name="outerRepeater"
        VerticalAlignment="Top"
        ItemTemplate ="{StaticResource CategoryTemplate}"&gt;
        &lt;ItemsRepeater.Layout&gt;
           &lt;StackLayout Orientation="Vertical" /&gt;
        &lt;/ItemsRepeater.Layout&gt;
    &lt;/ItemsRepeater&gt;
&lt;/ScrollViewer&gt;
                    
&lt;DataTemplate x:Key="CategoryTemplate" x:DataType="l:NestedCategory"&gt;
    &lt;StackPanel&gt;
        &lt;TextBlock Text="{x:Bind CategoryName}" Padding="8" FontSize="30"/&gt;
        &lt;ScrollViewer 
                HorizontalScrollBarVisibility="Disabled"
                VerticalScrollBarVisibility="Disabled"
                HorizontalScrollMode="Disabled"
                VerticalScrollMode="Disabled"&gt;
            &lt;ItemsRepeater x:Name="innerRepeater"
                           ItemsSource="{x:Bind CategoryItems}"
                           ItemTemplate="{StaticResource StringDataTemplateColor}"&gt;
                &lt;ItemsRepeater.Layout&gt;
                    &lt;StackLayout Orientation="Horizontal" /&gt;
                &lt;/ItemsRepeater.Layout&gt;
            &lt;/ItemsRepeater&gt;
        &lt;/ScrollViewer&gt;
    &lt;/StackPanel&gt;
&lt;/DataTemplate&gt;
                    
&lt;!-- The DataTemplate shown above is bound to a custom-class type called NestedCategory, 
which is defined in the code-behind. NestedCategory objects have the following two attributes: 
a CategoryName (string), and a collection of strings called CategoryItems. --&gt;
                    
&lt;!-- The inner ItemsRepeater is bound to its own, separate DataTemplate called StringDataTemplateColor: --&gt;
                    
&lt;DataTemplate x:Key="StringDataTemplateColor" x:DataType="x:String"&gt;
    &lt;Grid Background="{StaticResource SystemControlBackgroundAccentBrush}" Margin="10, 0, 10 10"&gt;
        &lt;TextBlock Padding="10" Text="{x:Bind}" 
                   Foreground="{StaticResource SystemControlForegroundAltHighBrush}" 
                   HorizontalAlignment="Center" TextWrapping="Wrap" VerticalAlignment="Center"/&gt;
    &lt;/Grid&gt;
&lt;/DataTemplate&gt;               
                </x:String>
            </local:ControlExample.Xaml>
        </local:ControlExample>

    </StackPanel>
</local:ItemsPageBase>
